<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ĞĞ¿Ñ‚Ğ¾Ğ²Ğµ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ·Ğ±Ñ€Ğ¾Ñ— â€¢ CASTRO</title>

<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="order.css">

<style>
.cart-item{border-bottom:1px solid #2a2a2a;padding:8px 0}
.cart-item-title{font-weight:600}
.cart-item small{color:#aaa;display:block}
.btn-remove{background:none;border:none;color:#ff5555;cursor:pointer}
.cart-img{width:48px;height:auto;margin-right:8px}
</style>
</head>

<body class="order">
<div class="sparks"></div>

<header class="pagehead">
  <div class="container pagehead__inner">
    <a class="back" href="index.html">â† ĞĞ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ñƒ</a>
    <div class="pagehead__title">
      <h1>
        <img src="assets/hero.gif" class="heroLogo" alt="CASTRO">
        ğŸ”« ĞĞ¿Ñ‚Ğ¾Ğ²Ğµ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ â€¢ <span class="brand-red">CASTRO</span>
      </h1>
      <p class="muted">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ñ â†’ Ğ¢Ğ¾Ğ²Ğ°Ñ€ â†’ ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ â†’ â• ĞšĞ¾ÑˆĞ¸Ğº â†’ ğŸ“© Discord</p>
    </div>
  </div>
</header>

<main class="container">
<div class="orderGrid">

<!-- LEFT -->
<div class="card">
<div class="hd"><div class="hd__title">ğŸ“ Ğ”Ğ°Ğ½Ñ–</div></div>
<div class="content">

<div class="row">
  <div>
    <label>Nick | Static ID *</label>
    <input id="nick" class="inp">
  </div>
  <div>
    <label>Discord *</label>
    <input id="disc" class="inp">
  </div>
</div>

<div class="obox">
<label>ğŸ“Œ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ñ *</label>
<div id="cats" class="cats"></div>
</div>

<div id="itemsWrap" class="obox" style="display:none">
<label>ğŸ›’ Ğ¢Ğ¾Ğ²Ğ°Ñ€ *</label>
<div id="items" class="items"></div>
</div>

<div id="qtyWrap" class="obox" style="display:none">
<label>ğŸ“¦ ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ *</label>
<div id="qtyGrid" class="qty-grid"></div>
</div>

<div id="armorWrap" class="obox" style="display:none">
<label>ğŸ¨ ĞšĞ¾Ğ»Ñ–Ñ€ Ğ±Ñ€Ğ¾Ğ½ĞµĞ¶Ğ¸Ğ»ĞµÑ‚Ñƒ *</label>
<input id="armorColor" class="inp">
</div>

<button id="addBtn" class="btn" disabled>â• Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ´Ğ¾ ĞºĞ¾ÑˆĞ¸ĞºĞ°</button>

</div>
</div>

<!-- RIGHT -->
<div class="card">
<div class="hd">
  <div class="hd__title">ğŸ›’ ĞšĞ¾ÑˆĞ¸Ğº</div>
  <div class="mono" id="orderId"></div>
</div>
<div class="content">
  <div id="cart"></div>
  <div id="cartTotal" class="mono">â€”</div>
  <button id="sendBtn" class="btn primary" disabled>ğŸ“© Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸</button>
  <div id="status" class="status"></div>
</div>
</div>

</div>
</main>

<script>
/* ================= CONFIG ================= */
const CONFIG={
ENDPOINT_URL:"https://odd-night-e9f6.d-f-12339.workers.dev",
AUTH_HEADER_NAME:"X-Auth",
AUTH_SECRET:"CASTRO_FORM_2026!9xQp"
};

/* ================= CATALOG ================= */
const CATALOG={
"Ğ’Ğ¾Ğ³Ğ½ĞµĞ¿Ğ°Ğ»ÑŒĞ½Ğ° Ğ·Ğ±Ñ€Ğ¾Ñ":[
{id:"pistol",name:"Pistol",price:8500,img:"guns/combat-pistol.png"},
{id:"machine_pistol",name:"Machine Pistol",price:23000,img:"guns/machine-pistol.png"},
{id:"pump_shotgun",name:"Pump Shotgun",price:25000,img:"guns/pump-shotgun.png"},
{id:"combat_pdw",name:"Combat PDW",price:33500,img:"guns/combat-pdw.png"},
{id:"assault_smg",name:"Assault SMG",price:35000,img:"guns/assault-smg.png"},
{id:"bullpup_rifle",name:"Bullpup Rifle",price:37500,img:"guns/bullpup-rifle.png"},
{id:"heavy_shotgun",name:"Heavy Shotgun",price:60000,img:"guns/heavy-shotgun.png"},
{id:"mini_smg",name:"Mini SMG",price:32500,img:"guns/mini-smg.png"},
{id:"special_carbine",name:"Special Carbine",price:60500,img:"guns/special-carbine.png"},
{id:"special_carbine_mk2",name:"Special Carbine Mk II",price:65500,img:"guns/special-carbine-mk2.png"},
{id:"carbine_rifle",name:"Carbine Rifle",price:30500,img:"guns/carbine-rifle.png"},
{id:"pump_shotgun_mk2",name:"Pump Shotgun Mk II",price:27500,img:"guns/pump-shotgun-mk2.png"},
{id:"heavy_revolver",name:"Heavy Revolver",price:35500,img:"guns/heavy-revolver.png"}
],
"Ğ¥Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ° Ğ·Ğ±Ñ€Ğ¾Ñ":[
{id:"folding_knife",name:"Ğ¡ĞºĞ»Ğ°Ğ´Ğ½Ğ¸Ğ¹ Ğ½Ñ–Ğ¶",price:3000,img:"guns/Stilet.png"},
{id:"hunting_knife",name:"ĞœĞ¸ÑĞ»Ğ¸Ğ²ÑÑŒĞºĞ¸Ğ¹ Ğ½Ñ–Ğ¶",price:9500,img:"guns/knife.png"}
],
"Ğ‘Ğ¾Ñ”Ğ¿Ñ€Ğ¸Ğ¿Ğ°ÑĞ¸":[
{id:"ammo_9mm",name:"9mm",price:55,img:"guns/9.png"},
{id:"ammo_12mm",name:"12mm",price:55,img:"guns/12.png"},
{id:"ammo_556",name:"5.56mm",price:60,img:"guns/5.png"},
{id:"ammo_762",name:"7.62mm",price:62,img:"guns/7.png"}
],
"Ğ‘Ñ€Ğ¾Ğ½ĞµĞ¶Ğ¸Ğ»ĞµÑ‚":[
{id:"armor",name:"Ğ‘Ñ€Ğ¾Ğ½ĞµĞ¶Ğ¸Ğ»ĞµÑ‚",price:9000,img:"guns/armo.png"}
]
};

/* ================= DISCOUNTS ================= */
const DISCOUNTS=[
{q:5,p:0},{q:10,p:2},{q:15,p:3},{q:20,p:4},{q:25,p:5},
{q:30,p:10},{q:35,p:15},{q:40,p:17},{q:45,p:19},{q:50,p:20}
];

/* ================= LOGIC ================= */
const state={order:`CASTRO-${Date.now()}`,cat:null,item:null,qty:null,disc:0};
const cart=[];
const $=id=>document.getElementById(id);
$("orderId").textContent=state.order;

function money(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");}

Object.keys(CATALOG).forEach(c=>{
let d=document.createElement("div");
d.className="chip";d.textContent=c;
d.onclick=()=>selectCat(c);
$("cats").appendChild(d);
});

function selectCat(c){
state.cat=c;state.item=null;state.qty=null;
$("items").innerHTML="";
$("itemsWrap").style.display="block";
$("qtyWrap").style.display="none";
$("armorWrap").style.display=c==="Ğ‘Ñ€Ğ¾Ğ½ĞµĞ¶Ğ¸Ğ»ĞµÑ‚"?"block":"none";

CATALOG[c].forEach(i=>{
let d=document.createElement("div");
d.className="item";
d.innerHTML=`<img src="${i.img}"><div>${i.name}<br>${money(i.price)}$</div>`;
d.onclick=()=>selectItem(i);
$("items").appendChild(d);
});
}

function selectItem(i){
state.item=i;
$("qtyWrap").style.display="block";
$("qtyGrid").innerHTML="";
DISCOUNTS.forEach(d=>{
let q=document.createElement("div");
q.className="qty";q.textContent=d.q;
q.onclick=()=>{state.qty=d.q;state.disc=d.p;check()};
$("qtyGrid").appendChild(q);
});
}

function check(){
$("addBtn").disabled=!(
state.item&&state.qty&&$("nick").value&&$("disc").value&&
(state.cat!=="Ğ‘Ñ€Ğ¾Ğ½ĞµĞ¶Ğ¸Ğ»ĞµÑ‚"||$("armorColor").value)
);
}

["nick","disc","armorColor"].forEach(i=>$(i).oninput=check);

$("addBtn").onclick=()=>{
let sub=state.qty*state.item.price;
let disc=Math.round(sub*state.disc/100);
let total=sub-disc;

cart.push({
id:state.item.id,
name:state.item.name,
img:state.item.img,
qty:state.qty,
unit:state.item.price,
discount:state.disc,
total,
armor:state.cat==="Ğ‘Ñ€Ğ¾Ğ½ĞµĞ¶Ğ¸Ğ»ĞµÑ‚"?$("armorColor").value:null
});
renderCart();
};

function renderCart(){
$("cart").innerHTML="";
let sum=0;
cart.forEach((i,idx)=>{
sum+=i.total;
$("cart").innerHTML+=`
<div class="cart-item">
<div class="cart-item-title">
<img src="${i.img}" class="cart-img">${i.name} Ã—${i.qty}
</div>
<small>${money(i.total)}$</small>
<button class="btn-remove" onclick="cart.splice(${idx},1);renderCart()">ğŸ—‘</button>
</div>`;
});
$("cartTotal").textContent="Ğ Ğ°Ğ·Ğ¾Ğ¼: "+money(sum)+"$";
$("sendBtn").disabled=!cart.length;
}

$("sendBtn").onclick=async()=>{
const payload={
order_id:state.order,
buyer:{nick:$("nick").value,discord:$("disc").value},
items:cart,
total:cart.reduce((a,b)=>a+b.total,0)
};

$("status").textContent="â³ ĞĞ°Ğ´ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ...";

await fetch(CONFIG.ENDPOINT_URL,{
method:"POST",
headers:{
"Content-Type":"application/json",
[CONFIG.AUTH_HEADER_NAME]:CONFIG.AUTH_SECRET
},
body:JSON.stringify(payload)
});

$("status").textContent="âœ… Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾!";
cart.length=0;renderCart();
};
</script>
</body>
</html>
