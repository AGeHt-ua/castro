<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon" type="image/png" href="assets/logo.png" />
  <title>–í—Å—Ç—É–ø —É CASTRO</title>

  <link rel="stylesheet" href="auth.css">
  <link rel="stylesheet" href="join.css">
</head>

<body class="page-join">
<!-- VIDEO LOADER (CASTRO) -->
<div class="vload" id="vload" aria-hidden="false">
  <div class="vload__bg"></div>

  <div class="vload__center">
    <img class="vload__logo" src="assets/hero.gif" alt="CASTRO">
    <div class="vload__ring" aria-hidden="true"></div>
    <div class="vload__text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>
  </div>

  <div class="vload__scan" aria-hidden="true"></div>
  <div class="vload__grain" aria-hidden="true"></div>
</div>
  

  <!-- üé¨ Background Video -->
  <div class="video-bg" aria-hidden="true">
    <video class="video-bg__video" autoplay muted loop playsinline preload="auto">
      <source src="assets/join-bag.mp4" type="video/mp4">
    </video>
    <div class="video-bg__overlay"></div>
  </div>

  <!-- Auth dock -->
  <div id="auth-box" class="auth">
    <button id="auth-login" class="auth__btn" type="button">
      <img class="auth__discord" src="assets/discord.svg" alt="">
      –£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord
    </button>

    <div id="auth-user" class="auth__user hidden">
      <img id="auth-avatar" class="auth__avatar" alt="">
      <span id="auth-name" class="auth__name"></span>
      <button id="auth-logout" class="auth__logout" type="button" title="–í–∏–π—Ç–∏">‚éã</button>
    </div>
  </div>

  <!-- Background FX -->
  <div class="bgfx" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>

  <header class="topbar" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">
    <a class="back back--pill" href="index.html">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>

    <div class="topbar__title">
      üìå –í—Å—Ç—É–ø —É
      <span class="castro castro--logo">
        CASTRO
        <img src="assets/hero.gif" alt="CASTRO" class="castroLogo">
      </span>
    </div>

    <div class="topbar__meta">
      <span class="chip">üõ°Ô∏è –ó–∞—Ö–∏—Å—Ç —Ç–æ–∫–µ–Ω–æ–º</span>
    </div>
  </header>

  <main class="wrap" role="main">
    <div class="grid">

      <!-- MAIN FORM -->
      <section class="card mainCard" aria-label="–ê–Ω–∫–µ—Ç–∞ –≤—Å—Ç—É–ø—É">
        <header class="head">
          <div class="brandText">
            <h1 class="title">–ê–Ω–∫–µ—Ç–∞ –Ω–∞ –≤—Å—Ç—É–ø —É —Å—ñ–º‚Äô—é <span class="castro">CASTRO</span></h1>
            <p class="sub">
              –ó–∞–ø–æ–≤–Ω—é–π —á–µ—Å–Ω–æ —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ. –ü—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑‚Äô—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ Discord.
            </p>
          </div>

          <div class="pillbar" aria-label="–ö–ª—é—á–æ–≤—ñ –∞–∫—Ü–µ–Ω—Ç–∏">
            <span class="pill">‚öîÔ∏è RP-–¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞</span>
            <span class="pill">üìå –ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏ ‚Ä¢ –í—ñ–π–Ω–∏ —Å—ñ–º–µ–π</span>
            <span class="pill">üéôÔ∏è –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è</span>
          </div>

          <div class="photoRow" aria-label="–§–æ—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞">
            <!-- UPLOAD (LEFT) -->
            <div class="photo photo--head">
              <label class="photo__frame" for="charPhoto">
                <img id="charPreview" class="photo__img" alt="">
                <div id="charPlaceholder" class="photo__placeholder">
                  <div class="photo__icon">üì∑</div>
                  <div class="photo__title">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–∂—É</div>
                  <div class="photo__sub">PNG / JPG / WebP ‚Ä¢ –±–∞–∂–∞–Ω–æ 1:1 –∞–±–æ –ø–æ –ø–æ—è—Å</div>
                  <div class="photo__btn" id="photoPickBtn">–û–±—Ä–∞—Ç–∏ —Ñ–æ—Ç–æ</div>
                </div>
              </label>

              <input
                id="charPhoto"
                name="charPhoto"
                type="file"
                accept="image/png, image/jpeg, image/webp"
              >

              <button type="button" class="photo__remove" id="photoRemove" disabled>
                ‚úñ –ü—Ä–∏–±—Ä–∞—Ç–∏ —Ñ–æ—Ç–æ
              </button>

              <div class="hint" id="photoHint" style="margin-top:10px">
                –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Ñ–æ—Ç–æ: <b>5 MB</b>.
              </div>
            </div>

            <!-- INFO (RIGHT) -->
            <aside class="photoInfo photoInfo--left" aria-label="–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ–æ—Ç–æ">
              <h3>‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ–æ—Ç–æ</h3>

              <p class="photoInfo__muted">
                –§–æ—Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ –¥–ª—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –æ—Å–æ–±–æ–≤–æ—ó —Å–ø—Ä–∞–≤–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.
              </p>

              <ul class="photoInfo__list">
                <li>–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (IC)</li>
                <li>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ RP-–∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—ñ</li>
                <li>–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏ / –Ω–∞–±–æ—Ä—É</li>
                <li>–ü—ñ–¥–≤‚Äô—è–∑–∫–∞ –∑–∞—è–≤–∫–∏ –≤ –∫–∞–¥—Ä–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—ñ</li>
              </ul>

              <div class="photoInfo__note">
                ‚ùó –í–∏–º–æ–≥–∏: –±–µ–∑ –º–∞—Å–æ–∫/—à–æ–ª–æ–º—ñ–≤, —á—ñ—Ç–∫–æ –≤–∏–¥–Ω–æ –æ–±–ª–∏—á—á—è ‚Ä¢ –±–∞–∂–∞–Ω–æ 1:1 –∞–±–æ –ø–æ –ø–æ—è—Å
              </div>
            </aside>
          </div>
        </header>

        <div class="body">
          <form id="joinForm" novalidate>
            <!-- Honeypot -->
            <div class="hp" aria-hidden="true">
              <label>–ù–µ –∑–∞–ø–æ–≤–Ω—é–≤–∞—Ç–∏</label>
              <input name="website" autocomplete="off" tabindex="-1">
            </div>

            <div class="section">
              <h3><span class="dot"></span> –î–∞–Ω—ñ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>
              <div class="section__body">
                <div class="section__inner">

                  <div class="field">
                    <label>–Ü–º‚Äô—è —Ç–∞ –≤—ñ–∫ (IRL)</label>

                    <div class="grid2">
                      <div class="subfield">
                        <span class="sub">–Ü–º‚Äô—è</span>
                        <input id="irlName" name="irlName" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ê–Ω–¥—Ä—ñ–π" required autocomplete="off">
                      </div>

                      <div class="subfield">
                        <span class="sub">–í—ñ–∫</span>
                        <input id="irlAge" name="irlAge" type="number" inputmode="numeric" min="10" max="80" placeholder="20" required autocomplete="off">
                      </div>
                    </div>

                    <!-- Backward-compatible field for backend/worker -->
                    <input id="irl" name="irl" type="hidden">
                  </div>

                  <div class="field auto-hidden">
                    <label for="nick">–í–∞—à –ù—ñ–∫–Ω–µ–π–º | Static ID:</label>
                    <input id="nick" name="nick" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: Dominic Castro | 12279" required autocomplete="off">
                  </div>

                </div>

                <div class="row">
                  <div class="field">
                    <label for="timeOnServer">–°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –≥—Ä–∞—î—à –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ?</label>
                    <select id="timeOnServer" name="timeOnServer" required>
                      <option value="">–û–±–µ—Ä–∏‚Ä¶</option>
                      <option>–ú–µ–Ω—à–µ –º—ñ—Å—è—Ü—è</option>
                      <option>1‚Äì3 –º—ñ—Å—è—Ü—ñ</option>
                      <option>3‚Äì6 –º—ñ—Å—è—Ü—ñ</option>
                      <option>–ü–æ–Ω–∞–¥ 6 –º—ñ—Å—è—Ü—ñ–≤</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="hoursPerDay">–°–∫—ñ–ª—å–∫–∏ –≥–æ–¥–∏–Ω –≥—Ä–∞—î—à –Ω–∞ –¥–µ–Ω—å?</label>
                    <input id="hoursPerDay" name="hoursPerDay" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 3‚Äì5 –≥–æ–¥–∏–Ω" required autocomplete="off">
                  </div>
                </div>
              </div>
            </div>

            <div class="section">
              <h3><span class="dot"></span> –î–æ—Å–≤—ñ–¥ —Ç–∞ –º–æ—Ç–∏–≤–∞—Ü—ñ—è</h3>
              <div class="section__body">
                <div class="section__inner">
                  <div>
                    <label for="exp">–î–æ—Å–≤—ñ–¥ —É—á–∞—Å—Ç—ñ —É —Å—ñ–º‚Äô—è—Ö/–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è—Ö</label>
                    <textarea id="exp" name="exp" placeholder="–î–µ –±—É–≤(-–ª–∞), —â–æ —Ä–æ–±–∏–≤(-–ª–∞), —á–æ–º—É –ø—ñ—à–æ–≤(-–ª–∞)?" required></textarea>
                    <div class="hint">–ß–∏–º —á–µ—Å–Ω—ñ—à–µ —ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ—à–µ ‚Äî —Ç–∏–º –∫—Ä–∞—â–µ.</div>
                  </div>
                </div>

                <div class="mt12">
                  <label for="why">–ß–æ–º—É —Ö–æ—á–µ—à –ø—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è —Å–∞–º–µ –¥–æ CASTRO?</label>
                  <textarea id="why" name="why" placeholder="–©–æ –æ—á—ñ–∫—É—î—à –≤—ñ–¥ —Å—ñ–º‚Äô—ó —ñ —â–æ –º–æ–∂–µ—à –¥–∞—Ç–∏ –≤–∑–∞–º—ñ–Ω?" required></textarea>
                </div>

                <div class="mt12">
                  <label for="skills">–¢–≤–æ—ó —Å–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —è–∫ –≥—Ä–∞–≤—Ü—è</label>
                  <textarea id="skills" name="skills" placeholder="RP, —Å—Ç—Ä—ñ–ª—è–Ω–∏–Ω–∞, –≤–æ–¥—ñ–Ω–Ω—è, —Ç–∞–∫—Ç–∏–∫–∞, –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è‚Ä¶" required></textarea>
                </div>
              </div>
            </div>

            <div class="section">
              <h3><span class="dot"></span> –ó–≤‚Äô—è–∑–æ–∫ —Ç–∞ –ø—Ä–∞–≤–∏–ª–∞</h3>
              <div class="section__body">
                <div class="section__inner">
                  <div class="row">
                    <div class="field">
                      <label for="mic">–ú–∞—î—à –º—ñ–∫—Ä–æ—Ñ–æ–Ω / –∫–æ—Ä–∏—Å—Ç—É—î—à—Å—è –≥–æ–ª–æ—Å–æ–≤–∏–º?</label>
                      <select id="mic" name="mic" required>
                        <option value="">–û–±–µ—Ä–∏‚Ä¶</option>
                        <option>–¢–∞–∫</option>
                        <option>–ù—ñ</option>
                      </select>
                    </div>
                  </div>

                  <div class="field auto-hidden">
                    <label for="discord">Discord:</label>
                    <span for="discord">(–ø–æ—Å–∏–ª–∞–Ω–Ω—è / @–Ω—ñ–∫)</span>
                    <input
                      id="discord"
                      name="discord"
                      placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: @nickname –∞–±–æ nickname#0000 –∞–±–æ <@!1234567890>"
                      required
                      autocomplete="off"
                      spellcheck="false"
                      pattern=".{3,}"
                      title="–í–≤–µ–¥–∏ Discord (–º—ñ–Ω—ñ–º—É–º 3 —Å–∏–º–≤–æ–ª–∏)"
                    >
                    <input type="hidden" name="discordMention" id="discordMention">
                  </div>
                </div>

                <div class="row mt12">
                  <div class="field">
                    <label for="rules">–ì–æ—Ç–æ–≤–∏–π(-–∞) –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å –ø—Ä–∞–≤–∏–ª CASTRO?</label>
                    <select id="rules" name="rules" required>
                      <option value="">–û–±–µ—Ä–∏‚Ä¶</option>
                      <option>–¢–∞–∫, –ø–æ–≤–Ω—ñ—Å—Ç—é</option>
                      <option>–ù—ñ</option>
                      <option>–Ü–Ω—à–µ</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="rename">–ì–æ—Ç–æ–≤–∏–π(-–∞) –∑–º—ñ–Ω–∏—Ç–∏ –ø—Ä—ñ–∑–≤–∏—â–µ –Ω–∞ CASTRO –∑–∞ –≤–∏–º–æ–≥–æ—é –∫–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–∞?</label>
                    <select id="rename" name="rename" required>
                      <option value="">–û–±–µ—Ä–∏‚Ä¶</option>
                      <option>–¢–∞–∫</option>
                      <option>–ù—ñ</option>
                      <option>–Ü–Ω—à–µ</option>
                    </select>
                  </div>
                </div>

                <div class="mt12">
                  <label for="extra">–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)</label>
                  <textarea id="extra" name="extra" placeholder="–ë—É–¥—å-—è–∫—ñ –≤–∞–∂–ª–∏–≤—ñ –¥–µ—Ç–∞–ª—ñ: —á–∞—Å–æ–≤–∏–π –ø–æ—è—Å, –≥—Ä–∞—Ñ—ñ–∫, –Ω–∞–≤–∏—á–∫–∏, –≤—ñ–¥–≥—É–∫–∏‚Ä¶"></textarea>
                </div>
              </div>
            </div>

            <div class="agree">
              <label class="agree__box">
                <input type="checkbox" id="agreeChk" required>
                <span class="agree__tick" aria-hidden="true"></span>
                <span class="agree__text">
                  –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—é, —â–æ –æ–∑–Ω–∞–π–æ–º–∏–≤—Å—è(-–ª–∞—Å—å) —Ç–∞ –ø–æ–≥–æ–¥–∂—É—é—Å—å —ñ–∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Å—ñ–º‚Äô—ó CASTRO.
                </span>
              </label>

              <details class="agree__details">
                <summary>üìú –í—ñ–¥–∫—Ä–∏—Ç–∏ –ø–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç –∑–æ–±–æ–≤‚Äô—è–∑–∞–Ω—å</summary>
                <div class="agree__rules">
                  <p>
                    –ü–æ–≥–æ–¥–∂—É—é—Å—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤—Å—ñ –≤–∫–∞–∑—ñ–≤–∫–∏ –∫–µ—Ä—ñ–≤–Ω–æ–≥–æ —Å–∫–ª–∞–¥—É. –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –ø—Ä–æ—Ö–∞–Ω–Ω—ñ –±—Ä–∞—Ç–∏ —É—á–∞—Å—Ç—å —É –≤—ñ–π–Ω—ñ —Å—ñ–º–µ–π —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤.
                    –£ —Ä–∞–∑—ñ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤–∏–º–æ–≥ ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è (—à—Ç—Ä–∞—Ñ, –ø–æ–Ω–∏–∂–µ–Ω–Ω—è –≤ —Ä–∞–Ω–∑—ñ, –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è).
                    –£ —Ä–∞–∑—ñ –∫—É–ø—ñ–≤–ª—ñ —Å—ñ–º–µ–π–Ω–æ–≥–æ –æ–¥—è–≥—É ‚Äî –Ω–µ –ø—Ä–æ–¥–∞–≤–∞—Ç–∏ —ñ–Ω—à–∏–º –ª—é–¥—è–º.
                    –£ —Ä–∞–∑—ñ —Å–∞–º–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –∑ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó ‚Äî —Å–ø–ª–∞—Ç–∏—Ç–∏ –ø–æ–¥–∞—Ç–æ–∫ 100.000$ —Ç–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –∫—É–ø–ª–µ–Ω–∏–π —Å—ñ–º–µ–π–Ω–∏–π –æ–¥—è–≥.
                  </p>
                </div>
              </details>
            </div>

            <div class="actions" id="actions">
              <button class="btn" type="submit" id="submitBtn" disabled>‚úÖ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É</button>
              <div class="status" id="status">–£–≤—ñ–π–¥–∏ —á–µ—Ä–µ–∑ Discord —ñ –ø–æ—Å—Ç–∞–≤ –≥–∞–ª–æ—á–∫—É.</div>
            </div>

            <div class="ok" id="ok">
              <h4>‚úÖ –ó–∞—è–≤–∫—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!</h4>
              <p id="okText">–ü—Ä–∏—î–¥–Ω—É–π—Å—è –¥–æ Discord –¥–ª—è –∑–≤‚Äô—è–∑–∫—É —Ç–∞ —Ä–æ–∑–≥–ª—è–¥—É –∑–∞—è–≤–∫–∏.</p>
              <a class="discord" id="discordBtn" href="#" target="_blank" rel="noopener">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ Discord</a>
            </div>

            <div class="footer">Family CASTRO ‚Ä¢ Ukraine GTA 5 RP</div>
          </form>
        </div>
      </section>

      <!-- SIDEBAR -->
      <aside class="card side sideCard" aria-label="–ü—ñ–¥–∫–∞–∑–∫–∏ –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é">
        <div class="mini">
          <h3>üìå –ü–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é</h3>
          <p>–¢–≤–æ—è –∑–∞—è–≤–∫–∞ –æ–¥—Ä–∞–∑—É –ø—Ä–∏–ª—ñ—Ç–∞—î —É –∫–∞–¥—Ä–æ–≤–∏–π –∫–∞–Ω–∞–ª Discord. –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ–± Discord –Ω—ñ–∫ –±—É–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π.</p>

          <div class="rule">‚ö†Ô∏è –§–µ–π–∫–æ–≤–∞ / –Ω–µ—è–∫—ñ—Å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è = –≤—ñ–¥–º–æ–≤–∞</div>

          <ul class="list">
            <li>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –ø–æ —Å—É—Ç—ñ, –±–µ–∑ ‚Äú–Ω–æ—Ä–º/–æ–∫‚Äù.</li>
            <li>–ü–∏—à–∏ —á–µ—Å–Ω–æ –ø—Ä–æ –¥–æ—Å–≤—ñ–¥ —ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –∑ —ñ–Ω—à–∏–º–∏ —Å—ñ–º‚Äô—è–º–∏.</li>
            <li>–Ø–∫—â–æ –Ω–µ –º–∞—î—à –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ ‚Äî –∫—Ä–∞—â–µ –≤–∫–∞–∂–∏ –æ–¥—Ä–∞–∑—É.</li>
          </ul>

          <!-- Progress -->
          <div class="jprog" aria-label="–ü—Ä–æ–≥—Ä–µ—Å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è">
            <div class="jprog__top">
              <span class="jprog__label">–ü—Ä–æ–≥—Ä–µ—Å –∞–Ω–∫–µ—Ç–∏</span>
              <span class="jprog__pct" id="progPct">0%</span>
            </div>
            <div class="jprog__bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div class="jprog__fill" id="progFill"></div>
            </div>
            <div class="jprog__steps" id="progSteps"></div>
          </div>

          <!-- WOW: score -->
          <div class="wowScore" aria-label="–û—Ü—ñ–Ω–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞">
            <div class="wowScore__top">
              <div class="wowScore__title">üß† –û—Ü—ñ–Ω–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</div>
              <div class="wowBadge" id="wowBadge">‚Äî</div>
            </div>

            <div class="wowScore__bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div class="wowScore__fill" id="wowFill"></div>
            </div>

            <div class="wowScore__meta">
              <span class="wowScore__num"><span id="wowScoreNum">0</span>/100</span>
              <span class="wowScore__chance" id="wowChance">–®–∞–Ω—Å: ‚Äî</span>
            </div>

            <div class="wowHint" id="wowHint">–ó–∞–ø–æ–≤–Ω—é–π –¥–µ—Ç–∞–ª—å–Ω–æ ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø—ñ–¥–Ω—ñ–º–µ —Ä–µ–π—Ç–∏–Ω–≥.</div>
          </div>

          <!-- WOW: dossier -->
          <div class="wowDossier" aria-label="–î–æ—Å—å—î –∫–∞–Ω–¥–∏–¥–∞—Ç–∞">
            <div class="wowDossier__head">
              <div class="wowDossier__kicker">DOSSIER</div>
              <div class="wowDossier__id" id="candId">CSTR-00000</div>
            </div>

            <div class="wowDossier__row">
              <div class="wowDossier__label">Discord</div>
              <div class="wowDossier__val" id="candDiscord">‚Äî</div>
            </div>

            <div class="wowDossier__row">
              <div class="wowDossier__label">–ö–ª–∞—Å</div>
              <div class="wowDossier__val" id="candClass">‚Äî</div>
            </div>

            <div class="wowDossier__row">
              <div class="wowDossier__label">–°—Ç–∞—Ç—É—Å</div>
              <div class="wowDossier__val" id="candStatus">–û—á—ñ–∫—É—î –¥–∞–Ω—ñ</div>
            </div>
          </div>

          <span class="tag">üî• Power in unity</span>
        </div>
      </aside>

    </div>
  </main>

  <!-- WOW PROTOCOL FULLPAGE -->
  <div class="wowOverlay wowHidden" id="wowOverlay" aria-hidden="true">
    <div class="wowOverlay__page">
      <div class="wowOverlay__card" role="dialog" aria-label="Recruitment protocol">
        <img src="assets/hero.gif" class="wowOverlay__logo" alt="CASTRO">
        <div class="wowOverlay__title">CASTRO ‚Ä¢ Recruitment Protocol</div>

        <div class="wowOverlay__meta">
          <div class="wowOverlay__id" id="wowOverlayId">CSTR-00000</div>
          <div class="wowOverlay__pct"><span id="wowOverlayPct">0</span>%</div>
        </div>

        <div class="wowOverlay__scan" aria-hidden="true"></div>

        <div class="wowOverlay__line">
          <span class="wowOverlay__dot"></span>
          <span id="wowOverlayMain" class="wowGlitch">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è‚Ä¶</span>
        </div>

        <div class="wowOverlay__steps" id="wowOverlaySteps">
          <div class="wowStep" data-step="0"><span class="wowStep__i">01</span> –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö</div>
          <div class="wowStep" data-step="1"><span class="wowStep__i">02</span> –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ—Ñ—ñ–ª—é</div>
          <div class="wowStep" data-step="2"><span class="wowStep__i">03</span> –ü–µ—Ä–µ–¥–∞—á–∞ —É –∫–∞–¥—Ä–∏</div>
        </div>

        <div class="wowOverlay__bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="wowOverlay__fill" id="wowOverlayFill"></div>
        </div>

        <div class="wowOverlay__sub" id="wowOverlaySub">–ù–µ –∑–∞–∫—Ä–∏–≤–∞–π —Å—Ç–æ—Ä—ñ–Ω–∫—É. –ô–¥–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞.</div>

        <div class="wowOverlay__term" id="wowOverlayTerm" aria-label="–õ–æ–≥ –ø—Ä–æ—Ç–æ–∫–æ–ª—É"></div>

        <div class="wowOverlay__actions wowHidden" id="wowOverlayActions">
          <a class="wowOverlay__btn wowOverlay__btn--discord" id="wowOverlayJoin" href="#" target="_blank" rel="noopener">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ Discord</a>
          <a class="wowOverlay__btn wowOverlay__btn--home" id="wowOverlayHome" href="index.html">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
        </div>

        <button class="wowOverlay__close wowHidden" id="wowOverlayClose" type="button" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úñ</button>
      </div>
    </div>
  </div>


  <script>
    // =========================
    // ‚úÖ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø
    // =========================
    const WORKER_BASE = "https://winter-cake-f101.d-f-12339.workers.dev";
    const TOKEN_URL   = WORKER_BASE + "/token";
    const SUBMIT_URL  = WORKER_BASE + "/submit";
    const DISCORD_INVITE = "https://discord.gg/Tx4VyZSAjN";

    const MAX_PHOTO_BYTES = 5 * 1024 * 1024; // 5 MB
    const DRAFT_KEY = "castro_join_draft_v1";

    // WOW
    const CAND_KEY = "castro_join_candidate_id_v1";

    // –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó (–∂–∏–≤–∏—Ç—å—Å—è –∑ auth.js)
    window.AUTH_USER = null;

    // =========================
    // ‚úÖ DOM
    // =========================
    const form = document.getElementById("joinForm");
    const statusEl = document.getElementById("status");
    const okEl = document.getElementById("ok");
    const okText = document.getElementById("okText");
    const btn = document.getElementById("submitBtn");
    const discordBtn = document.getElementById("discordBtn");
    const agreeChk = document.getElementById("agreeChk");
    const actionsEl = document.getElementById("actions");
    const discordInput = document.getElementById("discord");
    const discordMentionInput = document.getElementById("discordMention");

    // ‚úÖ IRL split (name + age) ‚Üí hidden 'irl' (–¥–ª—è –±–µ–∫–µ–Ω–¥—É)
    const irlNameInput = document.getElementById("irlName");
    const irlAgeInput  = document.getElementById("irlAge");
    const irlHidden    = document.getElementById("irl");

    const syncIrl = () => {
      if (!irlHidden) return;
      const n = (irlNameInput?.value || "").trim();
      const a = (irlAgeInput?.value || "").trim();
      irlHidden.value = (n && a) ? `${n}, ${a}` : (n || "");
    };

    irlNameInput?.addEventListener("input", syncIrl);
    irlAgeInput?.addEventListener("input", syncIrl);

    // –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –ø–æ–ª—è (—Å—Ö–æ–≤–∞–Ω—ñ) –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –±–ª–æ–∫—É–≤–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é/flow
    const initAutoHiddenFields = () => {
      const autoWraps = form.querySelectorAll(".auto-hidden");
      autoWraps.forEach(w => {
        w.querySelectorAll("input, select, textarea").forEach(el => {
          el.required = false;
          el.dataset.auto = "1";
        });
      });
    };

    const applyDiscordFromAuth = () => {
      const u = window.AUTH_USER;
      if (!discordInput || !discordMentionInput) return;

      if (u?.id) {
        const uname = (u.username || u.global_name || u.name || "").trim();
        discordMentionInput.value = String(u.id);
        discordInput.value = uname ? ("@" + uname.replace(/^@+/, "")) : "@‚Äî";
        discordInput.readOnly = true;
      } else {
        discordMentionInput.value = "";
        discordInput.readOnly = false;
      }
    };

    discordBtn.href = DISCORD_INVITE;

    // ‚úÖ –§–æ—Ç–æ
    const photoInput = document.getElementById("charPhoto");
    const previewImg = document.getElementById("charPreview");
    const placeholder = document.getElementById("charPlaceholder");
    const removeBtn = document.getElementById("photoRemove");
    const pickBtn = document.getElementById("photoPickBtn");
    const photoHint = document.getElementById("photoHint");

    let lastObjectUrl = null;

    pickBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      photoInput?.click();
    });

    const revokeLastUrl = () => {
      if (lastObjectUrl) {
        try { URL.revokeObjectURL(lastObjectUrl); } catch {}
        lastObjectUrl = null;
      }
    };

    const clearPhoto = () => {
      revokeLastUrl();
      if (photoInput) photoInput.value = "";
      if (previewImg) {
        previewImg.src = "";
        previewImg.style.display = "none";
      }
      if (placeholder) placeholder.style.display = "grid";
      if (removeBtn) removeBtn.disabled = true;
      if (photoHint) photoHint.textContent = "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Ñ–æ—Ç–æ: 5 MB.";
      wowSafe(updateWow); // <-- WOW
    };

    photoInput?.addEventListener("change", () => {
      const file = photoInput.files?.[0];
      if (!file) return clearPhoto();

      if (!file.type.startsWith("image/")) {
        clearPhoto();
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä–∏ —Ñ–∞–π–ª –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (PNG/JPG/WebP).");
        return;
      }

      if (file.size > MAX_PHOTO_BYTES) {
        clearPhoto();
        alert("–§–æ—Ç–æ –∑–∞–≤–µ–ª–∏–∫–µ. –ú–∞–∫—Å–∏–º—É–º 5 MB.");
        return;
      }

      revokeLastUrl();
      lastObjectUrl = URL.createObjectURL(file);

      previewImg.src = lastObjectUrl;
      previewImg.style.display = "block";
      placeholder.style.display = "none";
      removeBtn.disabled = false;

      if (photoHint) photoHint.textContent = "–§–æ—Ç–æ –¥–æ–¥–∞–Ω–æ ‚úÖ";
      wowSafe(updateWow); // <-- WOW
    });

    removeBtn?.addEventListener("click", clearPhoto);

    
    // Token + sending state
    let submitToken = null;
    let sending = false;

// =========================
    // ‚úÖ –ö–ù–û–ü–ö–ê: –≥–∞–ª–æ—á–∫–∞ + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
    // =========================
    const syncAgree = () => {
      const agreeOk = !!agreeChk.checked;
      const authOk = !!window.AUTH_USER;

      // validity without popping messages
      syncIrl();
      const validOk = form.checkValidity();
      const tokenOk = !!submitToken;
      const ready = authOk && agreeOk && validOk && tokenOk && !sending;

      btn.classList.toggle("ready", ready);
      btn.disabled = !ready;

      if (!authOk) statusEl.textContent = "üîê –£–≤—ñ–π–¥–∏ —á–µ—Ä–µ–∑ Discord, —â–æ–± –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É.";
      else if (!agreeOk) statusEl.textContent = "–ü–æ—Å—Ç–∞–≤ –≥–∞–ª–æ—á–∫—É —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤ –∑–∞—è–≤–∫—É.";
      else if (!validOk) statusEl.textContent = "–ó–∞–ø–æ–≤–Ω–∏ –≤—Å—ñ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è.";
      else if (!tokenOk) statusEl.textContent = "‚õî –ù–µ–º–∞—î —Ç–æ–∫–µ–Ω–∞ –∑–∞—Ö–∏—Å—Ç—É. –û–Ω–æ–≤–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.";
      else statusEl.textContent = "‚úÖ –ú–æ–∂–µ—à –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –∑–∞—è–≤–∫—É.";
    };

    agreeChk.addEventListener("change", () => {
      syncAgree();
      wowSafe(updateWow);
    });

    syncAgree();
    initAutoHiddenFields();

    // üîê –û—Ç—Ä–∏–º—É—î–º–æ —Å—Ç–∞—Ç—É—Å –ª–æ–≥—ñ–Ω—É –∑ auth.js
    window.addEventListener("castro-auth", (e) => {
      window.AUTH_USER = e.detail?.user || null;
      applyDiscordFromAuth();
      syncAgree();
      wowSafe(updateWow); // <-- WOW
    });

    if (window.__CASTRO_AUTH__?.user) {
      window.AUTH_USER = window.__CASTRO_AUTH__.user;
      syncAgree();
      wowSafe(updateWow);
    }

    // =========================
    // ‚úÖ –ß–µ—Ä–Ω–µ—Ç–∫–∞ (localStorage)
    // =========================
    const serializeDraft = () => {
      syncIrl();

      const fd = new FormData(form);
      fd.delete("charPhoto");

      const obj = {};
      for (const [k, v] of fd.entries()) obj[k] = String(v ?? "");
      obj._agree = agreeChk.checked ? "1" : "0";

      localStorage.setItem(DRAFT_KEY, JSON.stringify(obj));
      wowSafe(updateWow); // <-- WOW
    };

    const restoreDraft = () => {
      try {
        const raw = localStorage.getItem(DRAFT_KEY);
        if (!raw) return;
        const obj = JSON.parse(raw);

        for (const [k, v] of Object.entries(obj)) {
          if (k === "_agree") continue;
          const el = form.querySelector(`[name="${CSS.escape(k)}"]`);
          if (!el) continue;
          el.value = String(v ?? "");
        }

        if (obj.irl && (irlNameInput || irlAgeInput)) {
          const s = String(obj.irl || "").trim();
          const m = s.match(/^\s*([^,]+?)\s*(?:,\s*(\d{1,2}))?\s*$/);
          if (m) {
            if (irlNameInput && !irlNameInput.value) irlNameInput.value = (m[1] || "").trim();
            if (irlAgeInput && !irlAgeInput.value) irlAgeInput.value = (m[2] || "").trim();
          }
        }

        syncIrl();

        agreeChk.checked = obj._agree === "1";
        syncAgree();
      } catch {}
    };

    form.addEventListener("input", serializeDraft);
    restoreDraft();
    syncIrl();

    // =========================
    // ‚úÖ UI: –ø—Ä–æ–≥—Ä–µ—Å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è (sidebar) + –ø—ñ–¥—Å–≤—ñ—Ç–∫–∞ —Å–µ–∫—Ü—ñ–π
    // =========================
    const sections = Array.from(form.querySelectorAll(".section"));
    const progFill = document.getElementById("progFill");
    const progPct  = document.getElementById("progPct");
    const progSteps = document.getElementById("progSteps");

    const STEP_TITLES = ["–î–∞–Ω—ñ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞", "–î–æ—Å–≤—ñ–¥", "–ó–≤‚Äô—è–∑–æ–∫"];

    const isFieldMeaningful = (el) => {
      if (!el) return false;
      if (el.type === "checkbox") return el.checked;
      const v = (el.value ?? "").trim();
      return v.length > 0;
    };

    const isAutoField = (el) => !!el?.closest?.(".auto-hidden");

    const sectionProgress = (sec) => {
      const fields = Array.from(sec.querySelectorAll("input, select, textarea"))
        .filter(el => el.name && el.type !== "file" && el.type !== "hidden" && el.name !== "website" && !isAutoField(el));
      if (!fields.length) return { done: 0, total: 0, ratio: 1 };

      let done = 0;
      for (const el of fields) if (isFieldMeaningful(el)) done += 1;
      return { done, total: fields.length, ratio: done / fields.length };
    };

    const buildSteps = () => {
      if (!progSteps) return;
      progSteps.innerHTML = "";
      sections.forEach((sec, idx) => {
        const title = STEP_TITLES[idx] || `–ö—Ä–æ–∫ ${idx + 1}`;
        const pill = document.createElement("div");
        pill.className = "jstep";
        pill.textContent = `${idx + 1}. ${title}`;
        pill.addEventListener("click", () => {
          sec.scrollIntoView({ behavior: "smooth", block: "start" });
          markActiveSection(sec);
        });
        progSteps.appendChild(pill);
      });
    };

    const setProgress = (pct) => {
      const p = Math.max(0, Math.min(100, Math.round(pct)));
      if (progFill) progFill.style.width = `${p}%`;
      if (progPct) progPct.textContent = `${p}%`;
      const bar = progFill?.closest?.('[role="progressbar"]');
      if (bar) bar.setAttribute("aria-valuenow", String(p));
      return p;
    };

    const updateProgress = () => {
      let sum = 0;
      let count = 0;

      sections.forEach((sec) => {
        const { ratio } = sectionProgress(sec);
        sum += ratio;
        count += 1;
      });

      const agreeBoost = agreeChk.checked ? 1 : 0;
      const totalParts = count + 1;
      const pct = ((sum + agreeBoost) / totalParts) * 100;

      const p = setProgress(pct);

      sections.forEach((sec, idx) => {
        const { ratio } = sectionProgress(sec);
        sec.classList.toggle("is-done", ratio >= 0.85);
        const stepEl = progSteps?.children?.[idx];
        if (stepEl) stepEl.classList.toggle("is-done", ratio >= 0.85);
      });

      return p;
    };

    const markActiveSection = (activeSec) => {
      sections.forEach((sec, idx) => {
        const isActive = sec === activeSec;
        sec.classList.toggle("is-active", isActive);
        const stepEl = progSteps?.children?.[idx];
        if (stepEl) stepEl.classList.toggle("is-active", isActive);
      });
    };

    form.addEventListener("focusin", (e) => {
      const sec = e.target.closest?.(".section");
      if (sec) markActiveSection(sec);
    });

    // =========================
    // ‚úÖ FLOW: —Å–µ–∫—Ü—ñ—ó –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å—Å—è –ü–û –ß–ï–†–ó–Ü (–ø–ª–∞–≤–Ω–æ)
    // =========================
    const bodyOf = (sec) => sec.querySelector(".section__body");

    const markInitialRequired = () => {
      sections.forEach(sec => {
        const body = bodyOf(sec);
        if (!body) return;
        body.querySelectorAll("[required]").forEach(el => {
          if (isAutoField(el)) return;
          el.dataset.req = "1";
        });
      });
    };

    const disableSectionFields = (sec) => {
      const body = bodyOf(sec);
      if (!body) return;
      body.querySelectorAll("input,select,textarea,button").forEach(el => {
        if (isAutoField(el)) return;
        el.disabled = true;
      });
    };

    const enableSectionFields = (sec) => {
      const body = bodyOf(sec);
      if (!body) return;
      body.querySelectorAll("input,select,textarea,button").forEach(el => {
        if (isAutoField(el)) return;
        el.disabled = false;
      });
    };

    const sectionComplete = (sec) => {
      const body = bodyOf(sec);
      if (!body) return true;

      const requiredEls = Array.from(body.querySelectorAll("input,select,textarea"))
        .filter(el =>
          (el.dataset.req === "1" || el.required) &&
          el.type !== "file" &&
          el.type !== "hidden" &&
          el.name !== "website" &&
          !isAutoField(el)
        );

      if (!requiredEls.length) return true;

      return requiredEls.every(el => {
        const v = (el.value ?? "").trim();
        if (!v) return false;
        if (el.tagName === "SELECT" && !el.value) return false;
        return el.checkValidity();
      });
    };

    const setSectionOpen = (sec, open) => {
      const body = bodyOf(sec);
      if (!body) return;

      if (open) {
        sec.classList.add("is-open");
        sec.classList.remove("is-collapsed", "is-locked");
        enableSectionFields(sec);

        if (!sec.dataset.opened) {
          sec.dataset.opened = "1";
          sec.classList.add("was-just-opened");
          setTimeout(() => sec.classList.remove("was-just-opened"), 250);
        }
      } else {
        sec.classList.add("is-collapsed", "is-locked");
        sec.classList.remove("is-open");
        disableSectionFields(sec);
      }
    };

    let unlockedIndex = 0;

    const applyFlow = () => {
      while (unlockedIndex < sections.length - 1 && sectionComplete(sections[unlockedIndex])) {
        unlockedIndex += 1;
      }
      sections.forEach((sec, idx) => setSectionOpen(sec, idx <= unlockedIndex));
    };

    let flowTimer = null;
    const scheduleFlow = () => {
      if (flowTimer) clearTimeout(flowTimer);
      flowTimer = setTimeout(() => {
        applyFlow();
        updateProgress();
        syncAgree();
        wowSafe(updateWow); // <-- WOW
      }, 120);
    };

    const initFlow = () => {
      if (!sections.length) return;
      markInitialRequired();

      unlockedIndex = 0;
      sections.forEach((sec, idx) => {
        if (idx === 0) sec.dataset.opened = "1";
        else delete sec.dataset.opened;
        setSectionOpen(sec, idx === 0);
      });

      applyFlow();
    };

    form.addEventListener("input", scheduleFlow);
    form.addEventListener("change", scheduleFlow);

    buildSteps();
    initFlow();
    updateProgress();

    // =========================
    // ‚úÖ Token
    // =========================

    const fetchToken = async () => {
      try {
        const res = await fetch(TOKEN_URL, { method: "GET" });
        const json = await res.json().catch(() => null);
        if (!res.ok || !json?.token) throw new Error("token_failed");
        submitToken = json.token;
              syncAgree();
} catch {
        submitToken = null;
        syncAgree();
      }
    };
    fetchToken();

    // =========================
    // ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫
    // =========================
    const explainError = (res, json) => {
      if (res?.status === 413) return "‚ùå –§–æ—Ç–æ –∑–∞–≤–µ–ª–∏–∫–µ. –°—Ç–∏—Å–Ω–∏ –∞–±–æ –≤–∏–±–µ—Ä–∏ —ñ–Ω—à–µ (–¥–æ 5MB).";
      if (res?.status === 429) return "‚è≥ –ó–∞–±–∞–≥–∞—Ç–æ —Å–ø—Ä–æ–±. –ó–∞—á–µ–∫–∞–π —Ç—Ä–æ—Ö–∏ —ñ –ø–æ–≤—Ç–æ—Ä–∏.";
      if (res?.status === 403) return "‚õî –î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ (–ø–µ—Ä–µ–≤—ñ—Ä, —â–æ –≤—ñ–¥–∫—Ä–∏–≤ –∑ family-castro.fun).";
      if (res?.status === 400) return "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä –ø–æ–ª—è —Ç–∞ —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.";
      if (json?.error) return "‚ùå " + String(json.error);
      return "‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑ –∞–±–æ –Ω–∞–ø–∏—à–∏ –∫–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤—É.";
    };

    // =========================
    // ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–µ—Ä–µ–¥ —Å–∞–±–º—ñ—Ç–æ–º
    // =========================
    const validateBeforeSubmit = () => {
      syncIrl();
      const hp = form.querySelector('input[name="website"]');
      if (hp && hp.value.trim()) return { ok: false, msg: "‚õî –í—ñ–¥—Ö–∏–ª–µ–Ω–æ." };

      if (!form.checkValidity()) {
        form.reportValidity();
        return { ok: false, msg: "‚ùå –ó–∞–ø–æ–≤–Ω–∏ –≤—Å—ñ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ." };
      }

      if (!agreeChk.checked) return { ok: false, msg: "‚õî –°–ø–æ—á–∞—Ç–∫—É –ø–æ—Å—Ç–∞–≤ –≥–∞–ª–æ—á–∫—É –∑–≥–æ–¥–∏." };
      if (!submitToken) return { ok: false, msg: "‚õî –ù–µ–º–∞—î —Ç–æ–∫–µ–Ω–∞ –∑–∞—Ö–∏—Å—Ç—É. –û–Ω–æ–≤–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É —ñ —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑." };

      return { ok: true };
    };

    // =========================
    // ‚úÖ WOW: Candidate ID + Score + Dossier
    // =========================
    const wowFill = document.getElementById("wowFill");
    const wowScoreNum = document.getElementById("wowScoreNum");
    const wowChance = document.getElementById("wowChance");
    const wowBadge = document.getElementById("wowBadge");
    const wowHint = document.getElementById("wowHint");

    const candIdEl = document.getElementById("candId");
    const candDiscordEl = document.getElementById("candDiscord");
    const candClassEl = document.getElementById("candClass");
    const candStatusEl = document.getElementById("candStatus");

    const ensureCandidateId = () => {
      let id = localStorage.getItem(CAND_KEY);
      if (id) return id;

      // —è–∫—â–æ —î discord id ‚Äî —Ä–æ–±–∏–º–æ –±—ñ–ª—å—à "—Å—Ç–∞–±—ñ–ª—å–Ω–æ"
      const did = String(window.AUTH_USER?.id || "");
      let num = 0;
      for (let i = 0; i < did.length; i++) num = (num * 31 + did.charCodeAt(i)) >>> 0;

      const rnd = (num || Math.floor(Math.random() * 99999)) % 100000;
      id = "CSTR-" + String(rnd).padStart(5, "0");
      localStorage.setItem(CAND_KEY, id);
      return id;
    };

    const getTextLen = (id) => {
      const el = document.getElementById(id);
      const v = (el?.value || "").trim();
      return v.length;
    };

    const getSelectVal = (id) => (document.getElementById(id)?.value || "").trim();

    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

    // =========================
    // ‚úÖ SAFE CALL (–Ω—ñ–∫–æ–ª–∏ –Ω–µ –ª–∞–º–∞—î flow)
    // =========================
    const wowSafe = (fn) => { try { if (typeof fn === "function") fn(); } catch(e){ console.warn("wowSafe:", e); } };

    const computeScore = () => {
      // –±–∞–∑–æ–≤–∞ ‚Äú–≤–∞–≥–∞‚Äù (0..100)
      let score = 0;

      // AUTH
      if (window.AUTH_USER?.id) score += 18;

      // agree
      if (agreeChk.checked) score += 6;

      // photo
      const hasPhoto = !!photoInput?.files?.[0];
      if (hasPhoto) score += 12;

      // time on server
      const tos = getSelectVal("timeOnServer");
      if (tos === "–ü–æ–Ω–∞–¥ 6 –º—ñ—Å—è—Ü—ñ–≤") score += 10;
      else if (tos === "3‚Äì6 –º—ñ—Å—è—Ü—ñ") score += 8;
      else if (tos === "1‚Äì3 –º—ñ—Å—è—Ü—ñ") score += 6;
      else if (tos === "–ú–µ–Ω—à–µ –º—ñ—Å—è—Ü—è") score += 4;

      // hours per day (simple parse)
      const hpd = (document.getElementById("hoursPerDay")?.value || "").trim();
      if (hpd.length >= 3) score += 5;

      // mic
      const mic = getSelectVal("mic");
      if (mic === "–¢–∞–∫") score += 8;
      else if (mic === "–ù—ñ") score += 2;

      // rules/rename
      const rules = getSelectVal("rules");
      const rename = getSelectVal("rename");
      if (rules.startsWith("–¢–∞–∫")) score += 6;
      if (rename === "–¢–∞–∫") score += 5;

      // text depth
      const expL = getTextLen("exp");
      const whyL = getTextLen("why");
      const sklL = getTextLen("skills");

      score += clamp(Math.floor(expL / 80), 0, 10);
      score += clamp(Math.floor(whyL / 80), 0, 10);
      score += clamp(Math.floor(sklL / 80), 0, 8);

      // name + age (irl)
      const nameL = (irlNameInput?.value || "").trim().length;
      const ageV = Number((irlAgeInput?.value || "").trim());
      if (nameL >= 2) score += 4;
      if (ageV >= 14 && ageV <= 60) score += 3;

      // progress boost (–ø–æ–≤–µ–¥—ñ–Ω–∫–æ–≤–∏–π –≤–∞—É)
      const p = updateProgress(); // 0..100
      score += clamp(Math.round(p / 25), 0, 4); // +0..4

      score = clamp(score, 0, 100);

      // tier
      let tier = "Weak";
      let chance = "–ù–ò–ó–¨–ö–ò–ô";
      let hint = "–ó–∞–ø–æ–≤–Ω–∏ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ ‚Äî —Ü–µ –ø—ñ–¥–Ω—ñ–º–µ —à–∞–Ω—Å.";
      if (score >= 80) { tier = "Elite"; chance = "–í–ò–°–û–ö–ò–ô"; hint = "–°–∏–ª—å–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å. –¢—Ä–∏–º–∞–π —Ä—ñ–≤–µ–Ω—å —ñ –Ω–µ –ª–∏–π –≤–æ–¥—É."; }
      else if (score >= 55) { tier = "Good"; chance = "–°–ï–†–ï–î–ù–Ü–ô"; hint = "–î–æ–±—Ä–µ. –î–æ–¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏ –≤ –º–æ—Ç–∏–≤–∞—Ü—ñ—ó/–Ω–∞–≤–∏—á–∫–∞—Ö."; }
      else { tier = "Weak"; chance = "–ù–ò–ó–¨–ö–ò–ô"; hint = "–ü–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π + —Ñ–æ—Ç–æ + –º—ñ–∫—Ä–æ—Ñ–æ–Ω."; }

      return { score, tier, chance, hint };
    };

    const updateWow = () => {
      const id = ensureCandidateId();
      if (candIdEl) candIdEl.textContent = id;

      const u = window.AUTH_USER;
      const name = (u?.username || u?.global_name || u?.name || "").trim();
      if (candDiscordEl) candDiscordEl.textContent = name ? ("@" + name.replace(/^@+/, "")) : "‚Äî";

      const { score, tier, chance, hint } = computeScore();

      if (wowScoreNum) wowScoreNum.textContent = String(score);
      if (wowFill) wowFill.style.width = score + "%";
      if (wowChance) wowChance.textContent = "–®–∞–Ω—Å: " + chance;
      if (wowBadge) wowBadge.textContent = tier;
      if (wowHint) wowHint.textContent = hint;

      if (candClassEl) candClassEl.textContent = tier;
      if (candStatusEl) candStatusEl.textContent = u?.id ? "–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π" : "–û—á—ñ–∫—É—î Discord";

      // —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è badge
      wowBadge?.classList.toggle("is-elite", tier === "Elite");
      wowBadge?.classList.toggle("is-good", tier === "Good");
      wowBadge?.classList.toggle("is-weak", tier === "Weak");
    };

    // init wow
    wowSafe(updateWow);

    // =========================
    // =========================
    // ‚úÖ WOW: Cinematic overlay controls (MAXIMUM WOW)
    // =========================
    const wowOverlay = document.getElementById("wowOverlay");
    const wowOverlayFill = document.getElementById("wowOverlayFill");
    const wowOverlayMain = document.getElementById("wowOverlayMain");
    const wowOverlaySub = document.getElementById("wowOverlaySub");
    const wowStepsWrap = document.getElementById("wowOverlaySteps");
    const wowOverlayPct = document.getElementById("wowOverlayPct");
    const wowOverlayId = document.getElementById("wowOverlayId");
    const wowOverlayTerm = document.getElementById("wowOverlayTerm");
    const wowOverlayActions = document.getElementById("wowOverlayActions");
    const wowOverlayJoin = document.getElementById("wowOverlayJoin");
    const wowOverlayHome = document.getElementById("wowOverlayHome");
    const wowOverlayClose = document.getElementById("wowOverlayClose");


    let wowTimer = null;
    let wowTypingToken = 0;

    const setOverlayProgress = (pct) => {
      const p = clamp(Math.round(pct), 0, 100);
      if (wowOverlayFill) wowOverlayFill.style.width = p + "%";
      if (wowOverlayPct) wowOverlayPct.textContent = String(p);
      const bar = wowOverlayFill?.closest?.('[role="progressbar"]');
      if (bar) bar.setAttribute("aria-valuenow", String(p));
      return p;
    };

    const markStep = (idx) => {
      if (!wowStepsWrap) return;
      const steps = Array.from(wowStepsWrap.querySelectorAll(".wowStep"));
      steps.forEach((s, i) => {
        s.classList.toggle("is-active", i === idx);
        s.classList.toggle("is-done", i < idx);
      });
    };

    const termPush = (line) => {
      if (!wowOverlayTerm) return;
      const el = document.createElement("div");
      el.className = "wowTermLine";
      el.textContent = line;
      wowOverlayTerm.appendChild(el);
      // keep last ~10 lines
      while (wowOverlayTerm.children.length > 10) wowOverlayTerm.removeChild(wowOverlayTerm.firstElementChild);
      wowOverlayTerm.scrollTop = wowOverlayTerm.scrollHeight;
    };

    const typeTo = (el, text, speed = 18) => {
      if (!el) return;
      const token = ++wowTypingToken;
      el.textContent = ""; try{ el.setAttribute("data-text", text); }catch(e){}
      let i = 0;
      const tick = () => {
        if (token !== wowTypingToken) return;
        el.textContent = text.slice(0, i);
        i++;
        if (i <= text.length) setTimeout(tick, speed);
      };
      tick();
    };

    // ---- WebAudio: subtle scan beep ----
    let audioCtx = null;
    const ensureAudio = () => {
      try{
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === "suspended") audioCtx.resume();
      }catch(e){}
    };
    const beep = (freq = 880, durMs = 80, vol = 0.02) => {
      if (!audioCtx) return;
      const t0 = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = "sine";
      o.frequency.setValueAtTime(freq, t0);
      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(vol, t0 + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + durMs/1000);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(t0); o.stop(t0 + durMs/1000 + 0.02);
    };

    const showOverlay = () => {
      if (!wowOverlay) return;
      ensureAudio();

      wowOverlay.classList.remove("wowHidden");
      wowOverlay.classList.add("is-active");
      wowOverlay.setAttribute("aria-hidden", "false");

      const cid = ensureCandidateId();
      if (wowOverlayId) wowOverlayId.textContent = cid;

      if (wowOverlayTerm) wowOverlayTerm.innerHTML = "";
      termPush(`[${cid}] BOOT :: init protocol`);
      termPush(`AUTH :: ${window.AUTH_USER?.id ? "OK" : "WAIT"}`);

      setOverlayProgress(0);
      markStep(0);
      typeTo(wowOverlayMain, "–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Ç–æ–∫–æ–ª—É‚Ä¶");
      if (wowOverlaySub) wowOverlaySub.textContent = "–ù–µ –∑–∞–∫—Ä–∏–≤–∞–π —Å—Ç–æ—Ä—ñ–Ω–∫—É. –ô–¥–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞.";
      document.documentElement.classList.add("wowLock");
      document.body.classList.add("protocolMode");
      if (wowOverlayJoin) wowOverlayJoin.href = DISCORD_INVITE;
      if (wowOverlayActions) wowOverlayActions.classList.add("wowHidden");
      if (wowOverlayClose) wowOverlayClose.classList.add("wowHidden");

      // timeline ~18s
      const timeline = [
        { t: 700,   step:0, p: 8,  main:"–ó–±—ñ—Ä –¥–∞–Ω–∏—Ö –∞–Ω–∫–µ—Ç–∏‚Ä¶", sub:"–ó—á–∏—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ç–∞ —Ñ–æ—Ç–æ‚Ä¶", log:"FORM :: collected inputs" },
        { t: 2200,  step:0, p: 18, main:"–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö‚Ä¶", sub:"–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ–º–∏–ª–æ–∫ —Ç–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è‚Ä¶", log:"FORM :: normalize" },
        { t: 4200,  step:1, p: 36, main:"–ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ—Ñ—ñ–ª—é –∫–∞–Ω–¥–∏–¥–∞—Ç–∞‚Ä¶", sub:"–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É —Ç–∞ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ‚Ä¶", log:"AI :: profile analysis" },
        { t: 6100,  step:1, p: 52, main:"–û—Ü—ñ–Ω–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç—É—Ä–∏‚Ä¶", sub:"–°–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ä–º—É—î —Ä–µ–π—Ç–∏–Ω–≥ —Ç–∞ –∫–ª–∞—Å‚Ä¶", log:"AI :: scoring + tier" },
        { t: 8200,  step:2, p: 66, main:"–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞–∫–µ—Ç—É –¥–∞–Ω–∏—Ö‚Ä¶", sub:"–ü—ñ–¥–ø–∏—Å –ø–∞–∫–µ—Ç—É —Ç–∞ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è‚Ä¶", log:"PKG :: signed + encrypted" },
        { t: 10400, step:2, p: 78, main:"–ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏ —É –∫–∞–¥—Ä–æ–≤–∏–π –∫–∞–Ω–∞–ª‚Ä¶", sub:"–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —É Discord‚Ä¶", log:"NET :: transmit to –∫–∞–¥—Ä–æ–≤–∏–π" },
        { t: 13200, step:2, p: 86, main:"–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è‚Ä¶", sub:"–ú–∞–π–∂–µ –≥–æ—Ç–æ–≤–æ‚Ä¶", log:"NET :: awaiting ack" },
        // hold at 88 until real success/fail
        { t: 16000, step:2, p: 88, main:"–§—ñ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è‚Ä¶", sub:"–ù–µ –∑–∞–∫—Ä–∏–≤–∞–π —Å—Ç–æ—Ä—ñ–Ω–∫—É.", log:"FINAL :: lock 88%" },
      ];

      // clear old
      if (wowTimer) clearInterval(wowTimer);
      wowTimer = null;

      // drive smooth progress between points
      const start = performance.now();
      let lastIdx = -1;

      const tick = () => {
        const now = performance.now();
        const elapsed = now - start;

        // find current segment
        let idx = -1;
        for (let i = 0; i < timeline.length; i++){
          if (elapsed >= timeline[i].t) idx = i;
        }

        if (idx !== lastIdx && idx >= 0){
          const item = timeline[idx];
          lastIdx = idx;

          markStep(item.step);
          typeTo(wowOverlayMain, item.main);
          if (wowOverlaySub) wowOverlaySub.textContent = item.sub;
          termPush(item.log);
          beep(740 + idx*60, 80, 0.018);
        }

        // interpolate progress
        const prev = idx <= 0 ? {t:0, p:0} : timeline[idx-1];
        const curr = idx < 0 ? {t:0, p:0} : timeline[idx];
        const next = (idx+1 < timeline.length) ? timeline[idx+1] : curr;

        const segStartT = curr.t;
        const segEndT = next.t;
        const segStartP = curr.p;
        const segEndP = next.p;

        const x = (segEndT === segStartT) ? 1 : clamp((elapsed - segStartT) / (segEndT - segStartT), 0, 1);
        const p = segStartP + (segEndP - segStartP) * x;

        // do not exceed 88 unless success sets 100
        const capped = Math.min(p, 88);
        setOverlayProgress(capped);

        // subtle terminal "typing" pulse
        if (elapsed > 2000 && (Math.floor(elapsed/1200) !== Math.floor((elapsed-50)/1200))) {
          termPush("‚Ä¶");
        }

        wowTimer = requestAnimationFrame(tick);
      };

      wowTimer = requestAnimationFrame(tick);
    };

    const hideOverlay = () => {
      if (wowTimer) {
        try { cancelAnimationFrame(wowTimer); } catch(e) {}
        wowTimer = null;
      }
      if (!wowOverlay) return;
      wowOverlay.classList.add("wowHidden");
      wowOverlay.classList.remove("is-active");
      wowOverlay.setAttribute("aria-hidden", "true");
      document.documentElement.classList.remove("wowLock");
      document.body.classList.remove("protocolMode");
    };

    // Close button (only on error)
    wowOverlayClose?.addEventListener("click", () => {
      hideOverlay();
      // allow user to try again
      syncAgree?.();
    });


    const overlaySuccess = () => {
      if (wowTimer) {
        try { cancelAnimationFrame(wowTimer); } catch(e) {}
        wowTimer = null;
      }
      markStep(3);
      setOverlayProgress(100);
      termPush("OK :: protocol complete");
      if (wowOverlayMain) {
        wowOverlayMain.classList.add("wowGlitch--ok");
        typeTo(wowOverlayMain, "‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ó–∞—è–≤–∫—É –ø–µ—Ä–µ–¥–∞–Ω–æ.", 14);
      }
      if (wowOverlaySub) wowOverlaySub.textContent = "–ü–µ—Ä–µ–≤—ñ—Ä Discord. –î–æ—Å—å—î —Å—Ç–≤–æ—Ä–µ–Ω–æ.";
      beep(1100, 110, 0.022);
            // stay on full-page protocol screen + show buttons
      if (wowOverlayActions) wowOverlayActions.classList.remove("wowHidden");
};

    const overlayFail = (msg) => {
      if (wowTimer) {
        try { cancelAnimationFrame(wowTimer); } catch(e) {}
        wowTimer = null;
      }
      setOverlayProgress(35);
      termPush("ERR :: " + (msg || "unknown"));
      if (wowOverlayMain) {
        wowOverlayMain.classList.add("wowGlitch--err");
        typeTo(wowOverlayMain, "‚ö† –ü–æ–º–∏–ª–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª—É", 14);
      }
      if (wowOverlaySub) wowOverlaySub.textContent = msg || "–°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.";
      if (wowOverlayClose) wowOverlayClose.classList.remove("wowHidden");
      beep(220, 160, 0.028);
      setTimeout(() => hideOverlay(), 1100);
    };

    // =========================
    // ‚úÖ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º–∏
    // =========================

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!window.AUTH_USER) {
        statusEl.textContent = "‚õî –£–≤—ñ–π–¥–∏ —á–µ—Ä–µ–∑ Discord –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é –∑–∞—è–≤–∫–∏.";
        return;
      }

      if (sending) return;

      const v = validateBeforeSubmit();
      if (!v.ok) {
        statusEl.textContent = v.msg;
        return;
      }

      sending = true;
      btn.disabled = true;

      showOverlay(); // <-- WOW
      statusEl.textContent = "‚è≥ –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞—è–≤–∫—É‚Ä¶";

      const fd = new FormData(form);

      const file = photoInput?.files?.[0];
      if (file) fd.set("charPhoto", file, file.name);

      fd.set("agree", agreeChk.checked ? "yes" : "no");

      try {
        const res = await fetch(SUBMIT_URL, {
          method: "POST",
          headers: { "X-Token": submitToken },
          body: fd
        });

        const json = await res.json().catch(() => ({}));

        if (!res.ok || !json.ok) {
          const emsg = explainError(res, json);
          statusEl.textContent = emsg;
          overlayFail(emsg);
          await fetchToken();
          sending = false;
          syncAgree();
          wowSafe(updateWow);
          return;
        }

        // SUCCESS
        overlaySuccess();

        const cid = ensureCandidateId();
        statusEl.textContent = "‚úÖ –ì–æ—Ç–æ–≤–æ. –ü–µ—Ä–µ–≤—ñ—Ä Discord.";
        okEl.style.display = "block";
        if (actionsEl) actionsEl.style.display = "none";

        if (okText) okText.textContent = `–¢–≤–æ—î –¥–æ—Å—å—î —Å—Ç–≤–æ—Ä–µ–Ω–æ. –ù–æ–º–µ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–∞: ${cid}. –ü—Ä–∏—î–¥–Ω—É–π—Å—è –¥–æ Discord –¥–ª—è –∑–≤‚Äô—è–∑–∫—É.`;

        localStorage.removeItem(DRAFT_KEY);

        form.reset();
        clearPhoto();

        okEl.scrollIntoView({ behavior: "smooth", block: "start" });

        syncAgree();
        wowSafe(updateWow);
        await fetchToken();
      } catch (err) {
        console.error(err);
        const msg = "‚ùå –ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ. –ü–µ—Ä–µ–≤—ñ—Ä —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç —ñ —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.";
        statusEl.textContent = msg;
        overlayFail(msg);
        await fetchToken();
        sending = false;
        syncAgree();
        wowSafe(updateWow);
        return;
      }

      sending = false;
    });

</script>

  <!-- ‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó (–≤ –∫—ñ–Ω—Ü—ñ body) -->
  <script src="auth.js" defer></script>
  <script src="profile.js" defer></script>
  <script>
(function(){
  const loader = document.getElementById("vload");
  if(!loader) return;

  // –°–ø—Ä–æ–±—É—î–º–æ –∑–Ω–∞–π—Ç–∏ –≤—ñ–¥–µ–æ-—Ñ–æ–Ω –≤ —Ç–≤–æ—ó—Ö —Ä—ñ–∑–Ω–∏—Ö —à–∞–±–ª–æ–Ω–∞—Ö:
  const video =
    document.querySelector(".video-bg video") ||      // join/info/order
    document.querySelector(".hero-bg video") ||       // index
    document.querySelector("video#bgVideo") ||        // order (id —î) :contentReference[oaicite:5]{index=5}
    document.querySelector("video");

  // –Ø–∫—â–æ –≤—ñ–¥–µ–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—Ö–æ–≤–∞—î–º–æ –ª–æ–∞–¥–µ—Ä
  if(!video){
    hide();
    return;
  }

  document.documentElement.classList.add("is-video-loading");
  document.body.classList.add("is-video-loading");

  let done = false;

  // –•–æ–≤–∞—î–º–æ –∫—Ä–∞—Å–∏–≤–æ (—Ä–æ–∑—Å—ñ—é–≤–∞–Ω–Ω—è)
  function hide(){
    if(done) return;
    done = true;

    loader.classList.add("is-hide");
    loader.setAttribute("aria-hidden", "true");
    document.documentElement.classList.remove("is-video-loading");
    document.body.classList.remove("is-video-loading");
  }

  // –Ø–∫—â–æ –≤—ñ–¥–µ–æ –≤–∂–µ –º–∞—î –¥–∞–Ω—ñ ‚Äî –Ω–µ —á–µ–∫–∞—î–º–æ
  if(video.readyState >= 2){
    // readyState 2 = HAVE_CURRENT_DATA
    // –î–∞–º–æ –∫–∞–¥—Ä –∑'—è–≤–∏—Ç–∏—Å—è —ñ —Ö–æ–≤–∞—î–º–æ
    requestAnimationFrame(() => setTimeout(hide, 120));
    return;
  }

  // –ö–æ–ª–∏ –≤—ñ–¥–µ–æ –≥–æ—Ç–æ–≤–µ –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–µ—Ä—à–∏–π –∫–∞–¥—Ä
  const onReady = () => {
    // –î–∞–π –≤—ñ–¥–µ–æ —Ä–µ–∞–ª—å–Ω–æ –ø–æ—á–∞—Ç–∏ —Ä–µ–Ω–¥–µ—Ä
    requestAnimationFrame(() => setTimeout(hide, 120));
  };

  video.addEventListener("loadeddata", onReady, { once: true });
  video.addEventListener("canplay", onReady, { once: true });

  // –ü—ñ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞: –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤—ñ–¥–µ–æ –≥–ª—é—á–∏—Ç—å/–º–µ—Ä–µ–∂–∞ —Å–ª–∞–±–∫–∞ ‚Äî –Ω–µ —Ç—Ä–∏–º–∞—î–º–æ –≤—ñ—á–Ω–æ
  setTimeout(hide, 7000);

  // –Ø–∫—â–æ –≤–∫–ª–∞–¥–∫–∞ —Å—Ö–æ–≤–∞–Ω–∞ ‚Äî –Ω–µ –±–ª–æ–∫—É—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ª–æ–∞–¥–µ—Ä–æ–º
  document.addEventListener("visibilitychange", () => {
    if(document.hidden) hide();
  });

  // –°–ø—Ä–æ–±—É—î–º–æ "–ø—ñ–¥—à—Ç–æ–≤—Ö–Ω—É—Ç–∏" –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –º–æ–±—ñ–ª–∫–∞—Ö
  try { video.load(); } catch(e) {}
})();
</script>
  
</body>
</html>
 
